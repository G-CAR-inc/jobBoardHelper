generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model BrowserSession {
  id             String   @id @default(uuid())
  domain         String
  cookies        Json
  localStorage   Json
  sessionStorage Json
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
}

model Session {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now()) @map("created_at")

  publicIp       String @map("public_ip")
  sdkUsage       Int    @map("sdk_usage")

  accessToken String @map("access_token")
  refreshToken String @map("refresh_token")

  // 1:m Relations
  cookies Cookie[]

  @@map("sessions")
}

model Cookie {
  id       String  @id @default(uuid())
  key      String
  value    String
  domain   String
  path     String  @default("/")
  maxAge   Int?    @map("max_age") // Corresponds to renewInSec/Max-Age
  secure   Boolean @default(true)
  httpOnly Boolean @default(true) @map("http_only")

  // Relation to Session
  sessionId Int     @map("session_id")
  session   Session @relation(fields: [sessionId], references: [id], onDelete: Cascade)

  @@map("cookies")
}
