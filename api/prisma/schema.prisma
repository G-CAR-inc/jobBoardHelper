generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model BrowserSession {
  id             String   @id @default(uuid())
  domain         String
  cookies        Json
  localStorage   Json
  sessionStorage Json
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
}

model Session {
  id        String   @id @default(uuid())
  createdAt DateTime @default(now()) @map("created_at")
  
  publicIp  String   @map("public_ip")
  domain    String
  userAgent String @map("user_agent")
  acceptLanguage String @map("accept_language")
  accept String

  
  // 1:m Relations
  utmvcTokens   UtmvcToken[]
  reese84Tokens Reese84Token[]
  cookies       Cookie[]

  @@map("sessions")
}

model UtmvcToken {
  id        String   @id @default(uuid())
  token     String   
  createdAt DateTime @map("created_at") 

 
  sessionId String   @map("session_id")
  session   Session  @relation(fields: [sessionId], references: [id], onDelete: Cascade)

  @@map("utmvc_tokens")
}

model Reese84Token {
  id         String   @id @default(uuid())
  token      String
  renewInSec Int      @map("renew_in_sec")
  createdAt  DateTime @map("created_at") 
  domain     String

  sessionId String   @map("session_id")
  session   Session  @relation(fields: [sessionId], references: [id], onDelete: Cascade)

  @@map("reese84_tokens")
}

model Cookie {
  id       String  @id @default(uuid())
  key      String  
  value    String
  domain   String
  path     String  @default("/")
  maxAge   Int?    @map("max_age") // Corresponds to renewInSec/Max-Age
  secure   Boolean @default(true)
  httpOnly Boolean @default(true) @map("http_only")

  // Relation to Session
  sessionId String  @map("session_id")
  session   Session @relation(fields: [sessionId], references: [id], onDelete: Cascade)

  @@map("cookies")
}